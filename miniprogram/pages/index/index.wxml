  <!-- 拍照弹窗 -->
  <view class="camera-popup {{showCameraPopup ? 'show' : ''}}">
    <view class="camera-header">
      <view class="camera-close" bindtap="onCloseCameraPopup">
        <text>✕</text>
      </view>
      <text class="camera-title">拍照打卡</text>
      <view class="camera-save-btn {{cameraPhotos.length > 0 ? 'active' : ''}}" bindtap="onSavePhotos">
        <text>保存</text>
      </view>
    </view>

    <!-- 调整图片弹窗 -->
    <view class="adjust-popup {{isAdjustingPhoto ? 'show' : ''}}">
      <view class="adjust-header">
        <view class="adjust-cancel" bindtap="onCancelAdjust">取消</view>
        <text class="adjust-title">调整图片</text>
        <view class="adjust-confirm" bindtap="onConfirmAdjust">完成</view>
      </view>
      <view class="adjust-viewport">
        <view class="adjust-frame">
          <image 
            class="adjust-image" 
            src="{{cameraPhotos[adjustPhotoIndex]}}"
            mode="aspectFill"
            style="transform: scale({{adjustScale}}) translate({{adjustX}}px, {{adjustY}}px);"
            bindtouchstart="onTouchAdjustStart"
            bindtouchmove="onTouchAdjustMove"
            bindtouchend="onTouchAdjustEnd"
          ></image>
          <view class="adjust-mask"></view>
        </view>
        <view class="adjust-hint">
          <text>双指缩放，单指拖动</text>
        </view>
      </view>
    </view>

    <!-- 取景框 -->
    <view class="camera-viewfinder">
      <camera 
        device-position="back" 
        flash="off" 
        class="camera-element"
      ></camera>
      <view class="viewfinder-frame">
        <view class="frame-corner tl"></view>
        <view class="frame-corner tr"></view>
        <view class="frame-corner bl"></view>
        <view class="frame-corner br"></view>
      </view>
    </view>

    <!-- 照片预览 - 横向排列 -->
    <view class="photo-thumbnail-list" wx:if="{{cameraPhotos.length > 0}}">
      <scroll-view scroll-x class="thumbnail-scroll" enhanced show-scrollbar="{{false}}">
        <view 
          wx:for="{{cameraPhotos}}" 
          wx:key="index"
          class="thumbnail-item {{currentCameraIndex === index ? 'active' : ''}}"
        >
          <image class="thumbnail-img" src="{{item}}" mode="aspectFill" bindtap="onStartAdjustPhoto" data-index="{{index}}"></image>
          <view class="thumbnail-delete" catchtap="onDeletePhoto" data-index="{{index}}">✕</view>
        </view>
      </scroll-view>
    </view>

    <!-- 底部控制栏 -->
    <view class="camera-controls">
      <view class="control-btn" bindtap="onChooseFromAlbum">
        <view class="control-icon-wrapper">
          <text class="control-icon">🖼️</text>
        </view>
        <text class="control-label">相册</text>
      </view>
      <view class="capture-wrapper">
        <view class="capture-btn" bindtap="onTakePhoto">
          <view class="capture-inner"></view>
        </view>
      </view>
      <view class="control-placeholder"></view>
    </view>
  </view>

  <!-- 隐藏的 canvas 用于裁剪 -->
  <canvas canvas-id="cropCanvas" style="width: 600px; height: 600px; position: absolute; left: -9999px;"></canvas>
</view>